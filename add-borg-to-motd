#!/bin/bash

set -e
THISDIR="$(dirname "$(readlink -f "$0")")"
source "${THISDIR}/common"

source /root/.borg

set +e
BORG_OUTPUT="$("${BORG}" list --prefix "$(hostname)" ${REPOSITORY} | tail -n 3)"
SALL_GOOD=$?
set -e

if [[ $SALL_GOOD -eq 0 ]] ; then
  header "Latest Backups"
  echo "${BORG_OUTPUT}"
else
  say_color "\e[41m" "Unable to query backups"
  exit "${SALL_GOOD}"
fi

if [[ -r "${BORG_OUT}" ]] ; then
  echo -ne "${HEADER_COLOR}"
  "${EXTRACT}" "${BORG_OUT}"
  reset_color
fi
